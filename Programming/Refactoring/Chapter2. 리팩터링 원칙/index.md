### 리팩터링 원칙

- 리팩터링 이란?

  - [명사]: 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하고 쉽도록 내부 구조를 변경하는 기법
  - [동사]: 소프트웨어의 겉보기 동작은 그대로 유지한 채, 여러가지 리팩터링 기법을 적용해서 소프트웨어를 재구성하다.
    즉 리팩터링은 코드를 변경하기 전과 후의 코드가 똑같이 동작해야만 한다.
    완전히 똑같다는 말이 아니라 성능은 변할 수 있어도 사용자 시점에서는 달라지는 점이 없어야 한다.

- 두개의 모자

  - 소프트웨어를 개발 할 때는 목적을 명확하게 구분해야 한다.
    목적이 '기능 추가'냐, '리팩터링'이냐.
  - 목적이 기능 추가일 경우: 기존코드를 절대 건드리지 않고 새 기능을 추가하기만 한다.
  - 목적이 리팩터링 일 경우: 기능 추가는 절대 하지 않고 오로지 코드 재구성에만 전념한다. (새로운 테스트도 만들지 않는다.)

- 리팩터링을 하는 이유?

  - 리팩터링을 하면 소프트웨어 설계가 좋아진다.
  - 리팩터링을 하면 소프트웨어를 이해하기 쉬워진다.
  - 리팩터링을 하면 버그를 쉽게 찾을 수 있다.
  - 리팩터링하면 프로그래밍 속도를 높일 수 있다.

- 리팩터링은 언제 해야 할까?

  - 3의 법칙

    1. 처음에는 그냥 한다.
    2. 비슷한일을 두번째로 하게 되면(중복이 생겼다) 당황하겠지만, 그래도 계속 진행한다.
    3. 비슷한 일을 세 번째 하게 되면 리팩터링 한다.

  - 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기

    - 코드를 살펴보면서 구조를 살짝 바꾸면 다른 작업을 하기가 훨씬 쉬워질 만한 부분을 찾는다.

  - 이해를 위한 리팩터링: 코드를 이해하기 쉽게 만들기

  - 쓰레기 줍기 리팩터링

    - 간단히 수정할 수 있는것은 즉시 수정하고, 시간이 걸리는 일은 메모만 남기고 나중에 처리한다.

  - 계획된 리팩터링 vs 수시로 하는 리팩터링
    - 앞서 본 '준비를 위한 리팩터링', '이해를 위한 리팩터링', '쓰레기 줍기 리팩터링'은 모두 기회가 될 대만 진행한다.
    - 하지만 리팩터링은 프로그래밍을 할때 자연히 녹아들어야한다. 예를들어 기능을 추가하거나 버그를 잡는동안 리팩터링도 함께 진행한다. (수시로 하는 리팩터링)

- 리팩터링을 하지 말아야 할 때

  - 외부 API 다루듯 호출해서 쓰는 코드라면 지저분해도 그냥 쓴다. 내부 동작을 이해해야 할 시점에 리펙터링을 해야 효과가 있기 때문이다.
  - 리팩터링하는 것보다 처음부터 새로 작성하는게 쉬울 때도 리팩터링 하지 않음.

- 리팩터링 시 고려해야 할 문제

  - 새 기능 개발 속도 저하

    - 리팩터링의 궁극적인 목적은 개발 속도를 높여서, 더 적은 노력으로 더 많은 가치를 창출하는 것이다.
    - 코드가 건강하면 기존 코드를 새로운 방식으로 조합하기 쉬워서 복잡한 새 기능을 더 빨리 추가 할 수 있다.

  - 코드 소유권

    - 코드 소유권이 온전히 나에게만있으면 단순히 함수선언바꾸기로 선언자체와 호출하는곳을 변경하여 리팩토링할 수 있지만,
      코드 소유권이 나에게 없을때는 문제가된다.(ex. 고객에게 제공하는 API, 다른팀에서 제공해주는 모듈의 경우)
    - 위에 말한것처럼 코드 소유권이 나에게 없을때는 기존 함수는 그대로 두고 함수 본문에서 새로운 함수를 호출하도록 만들어서 리팩토링한다.

  - 브랜치

    - 일반적으로 개인의 브랜치를 따서 작업을한다음에 나중에 한번에 마스터로 머지를 한다.
      하지만, 이런식으로 작업하면 마스터로 머지하는시간이 길어질수록 고통받을 수 있기 때문에 수시로 마스터를 개인브랜치로 풀해온다.
    - 이런 방법은 마스터와 브랜치를 통합하는 기간이 길어질수록 기하급수적으로 힘들어진다.
      때문에 통합하는시간을 최대한 줄여야한다. 최소 하루에 한번은 통합할 수 있도록 !

  - 테스팅

    - 일반적으로 리펙터링을 하면 프로그램의 동작은 그대로 유지되어야한다.
      하지만, 실수를 저지르고 재빨리 해결하면 문제가 되지않지만 복구하는데 오래걸린다면 문제가 될 수 있다.
      테스팅을 하면 이 실수에대해 미리 예방할 수 있고 실수를 하더라도 재빠르게 오류를 잡을 수 있다.

  - 레거시 코드
  - 데이터베이스

- 리팩터링, 아키텍처, 애그니(YAGNI)

  - 점진적 설계라고 한다. You Aren't Going To Need It.

- 리팩터링과 소프트웨어 개발 프로세스
- 리팩터링과 성능
  - 시스템에 대해 잘 안다고 하더라도 섣불리 추측하지말고, 성능을 측정해서 정확한 오류를 도출해내야한다.
