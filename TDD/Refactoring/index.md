### 리팩토링

- 프로그램이 새로운 기능을 추가하기에 편한 구조가 아니라면, 먼저 기능을 추가하기 쉬운 형태로 리팩토링하고 나서 원하는 기능을 추가한다.

- 리팩터링하기 전에 제대로 된 테스트부터 마련한다. 테스트는 반드시 자가진단하도록 만든다.

- 리팩터링은 프로그램 수정을 작은 단계로 나눠서 진행한다. 그래서 중간에 실수하더라도 버그를 쉽게 찾을 수 있다.

---

### 리팩토링 TIP

- 긴 함수를 리팩터링 할 때는 전체 동작을 각각의 부분으로 나눌 수 있는 지점을 찾자 !
- 코드 조각을 별도의 함수로 추출하고 그 코드가 하는일을 설명하는 이름을 잘 지어주자 !
- 한번 수정하고나면 곧바로 컴파일하고 테스트해서 실수한게 없는지 확인하자 !
- 테스트 후 문제가 없다면 변경사항을 로컬 버전 관리 시스템(깃 등..)에 커밋하고, 이런 자잘한 리팩토링이 어느정도 뭉치면 공유 저장소로 푸쉬 하자. (컴파일 -> 테스트 -> 커밋)
- 추출 함수 내에서 얻을 수 있는 변수는 매개변수로 전달 할 필요가 없다. (임시 변수를 질의 함수로 바꾸기)
  임시 변수를 질의 함수로 바꿔서 변수 인라인을 하자 !

---

#### 초기 단계 (구조 보강)

- 자바스크립트 같은 동적 타입 언어는 변수나 매개변수 명에 타입이 드러나게 작성하자.
  (역할이 뚜렷하지 않을 때에는 부정 관사(a/an)을 붙인다. aPerformance)

- 반복문을 돌려 쌓는 임시변수 제거방법

  1. 반복문 쪼개기

     - 반복문내에 함수 부분을 따로 빼낸다.

  2. 문장 슬라이드 하기

     - 값을 누적시키는 지역변수를 쪼갠 반복문 바로 위로 옮긴다.

  3. 임시 변수를 질의 함수로 바꾸기

     - 1번과 2번을 수행하면 값갱신과 관련한 문장이 한데 모아지는데 이렇게되면 더 수월하게 추출이 가능.
     - 질의 함수를 만들때는 명확한 이름을 붙여줘야한다 꼭!! (마땅히 생각나는게없으면 임시적으로 아무거나 붙이고 나중에 생각 하자)

  4. 변수를 인라인하기
     - 질의 함수를 지역변수에 따로 할당하지않고 사용처에 인라인으로 넣는다.

이러한 리팩토링을 통해서 성능이 안좋아질수도 있지만 대체적으로 미미하다.
그러므로 '특별한 경우가 아니라면 일단 무시하자'.
리팩터링 때문에 성능이 떨어진다면, 리팩터링을 마무리하고 나서 성능을 개선하자!

#### 계산 단계와 포맷팅(출력) 분리하기

- 단계 쪼개기.

  - 해당 함수의 로직을 두 단계로 쪼갠다.
    첫 단계에서는 필요한 데이터를 처리하고, 두번째 단계에서는 앞서 처리한 결과를 텍스트나 HTML로 표현하는 단계다.
  - 이 statement에서는 본문전체가 두번째 단계에 해당함. (result: 청구 내역을 텍스트로 처리)
    본문 전체를 "함수 추출하기"를 한다.

1. 계산 단계 (createStatementData.js)

- 조건부 로직은 코드 수정횟수가 늘어날수록 골치덩이가 될 수 있다. (amountFor 메소드)
  이것을 "다형성"을 활용하여 리팩터링 해보자!

2. 포맷팅 단계 (htmlStatement.js -> renderHtml())
